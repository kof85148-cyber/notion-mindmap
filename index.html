<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KeepMind Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <style>
        :root { --primary: #fb0; --bg: #ffffff; --sidebar-w: 260px; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; background: #fff; }

        /* éŸ¿æ‡‰å¼å´é‚Šæ¬„ */
        #sidebar { 
            width: var(--sidebar-w); background: #f8f9fa; border-right: 1px solid #ddd; 
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            z-index: 100;
        }
        .sidebar-header { padding: 20px; font-weight: bold; background: var(--primary); display: flex; justify-content: space-between; }
        .tag-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .tag-item { padding: 10px; cursor: pointer; border-radius: 5px; margin-bottom: 5px; }
        .tag-item:hover { background: #eee; }
        .tag-item.active { background: #e0e0e0; font-weight: bold; }

        /* ä¸»å·¥ä½œå€ */
        #main-content { flex-grow: 1; display: flex; flex-direction: column; position: relative; width: 100%; }
        
        /* å·¥å…·åˆ—å„ªåŒ– */
        .toolbar { padding: 10px; background: #fff; border-bottom: 1px solid #eee; display: flex; gap: 8px; align-items: center; overflow-x: auto; }
        .toolbar button { white-space: nowrap; padding: 8px 12px; border-radius: 20px; border: 1px solid #ddd; background: #fff; font-size: 14px; }

        /* ç·¨è¼¯å€åŸŸ */
        #editor-split { display: flex; flex-grow: 1; overflow: hidden; }
        #text-outline { width: 30%; border: none; border-right: 1px solid #eee; padding: 15px; outline: none; font-size: 16px; transition: width 0.3s; }
        #cy-area { flex-grow: 1; position: relative; }
        #cy { width: 100%; height: 100%; }

        /* æ‰‹æ©Ÿæ¨¡å¼é©é… */
        @media (max-width: 768px) {
            #sidebar { position: absolute; transform: translateX(-100%); height: 100%; }
            #sidebar.open { transform: translateX(0); }
            #text-outline { width: 0; padding: 0; display: none; }
            #text-outline.open { width: 100%; display: block; position: absolute; z-index: 90; background: #fff; height: 100%; }
        }

        /* æµ®å‹•ç·¨è¼¯é¢æ¿ */
        #floating-input { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #fff; padding: 10px; border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex; gap: 10px; z-index: 1000; width: 90%; max-width: 500px;
        }
        #node-input { border: none; outline: none; flex-grow: 1; padding: 5px 15px; font-size: 16px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header">
            <span>KeepMind ç­†è¨˜</span>
            <button onclick="toggleSidebar()" style="border:none; background:none; cursor:pointer;">âœ•</button>
        </div>
        <div class="tag-list" id="tag-container">
            <div class="tag-item active" onclick="showCategory('all')">ğŸ“‚ æ‰€æœ‰ç­†è¨˜</div>
            <div class="tag-item" onclick="showCategory('work')">ğŸ’¼ å·¥ä½œ</div>
            <div class="tag-item" onclick="showCategory('personal')">ğŸ  å€‹äºº</div>
        </div>
    </div>

    <div id="main-content">
        <div class="toolbar">
            <button onclick="toggleSidebar()">â˜° é¸å–®</button>
            <button onclick="toggleOutline()">ğŸ“ å¤§ç¶±æ¨¡å¼</button>
            <button onclick="cy.fit()">ğŸ¯ å±…ä¸­</button>
            <button style="background:var(--primary)" onclick="copyJSON()">ğŸ“‹ è¤‡è£½å­˜æª”</button>
        </div>

        <div id="editor-split">
            <textarea id="text-outline" placeholder="è¼¸å…¥ç¸®æ’æ–‡å­—..." oninput="syncToMap()"></textarea>
            <div id="cy-area">
                <div id="cy"></div>
            </div>
        </div>

        <div id="floating-input">
            <input type="text" id="node-input" placeholder="é¸å–ç¯€é»ä¸¦è¼¸å…¥æ–‡å­—..." onchange="updateSelectedNode()">
            <button onclick="addNode()" style="background:var(--primary); border:none; border-radius:50%; width:35px; height:35px; color:#fff;">ï¼‹</button>
        </div>
    </div>

    <script>
        let cy;
        // åˆå§‹åŒ–ç•«å¸ƒ (é‡å°æ‰‹æ©Ÿé»æ“Šå„ªåŒ–)
        function initCy() {
            cy = cytoscape({
                container: document.getElementById('cy'),
                elements: [{ data: { id: 'root', label: 'æˆ‘çš„ä¸»é»å­' } }],
                style: [
                    { selector: 'node', style: {
                        'label': 'data(label)', 'background-color': '#fff', 'border-color': '#fb0',
                        'border-width': 2, 'shape': 'round-rectangle', 'padding': '12px',
                        'width': 'label', 'height': 'label', 'text-valign': 'center', 'font-size': '14px'
                    }},
                    { selector: 'node:selected', style: { 'border-width': 4, 'border-color': '#333' }},
                    { selector: 'edge', style: { 'curve-style': 'taxi', 'line-color': '#ddd', 'width': 2 }}
                ],
                layout: { name: 'breadthfirst', directed: true }
            });

            cy.on('tap', 'node', (e) => {
                document.getElementById('node-input').value = e.target.data('label');
                document.getElementById('node-input').focus();
            });
        }

        // åˆ‡æ›å´é‚Šæ¬„ (æ‰‹æ©Ÿç‰ˆé‡è¦)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // åˆ‡æ›æ–‡å­—å¤§ç¶± (æ‰‹æ©Ÿç‰ˆå¯æ”¶åˆ)
        function toggleOutline() {
            const el = document.getElementById('text-outline');
            el.classList.toggle('open');
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        function copyJSON() {
            const data = JSON.stringify(cy.json().elements);
            navigator.clipboard.writeText(data);
            alert("JSON å·²è¤‡è£½ï¼è«‹è²¼å› Notion å­˜æª”ã€‚");
        }

        function updateSelectedNode() {
            const sel = cy.$(':selected')[0];
            if(sel) {
                sel.data('label', document.getElementById('node-input').value);
                syncToText();
            }
        }

        function addNode() {
            const sel = cy.$(':selected')[0] || cy.nodes()[0];
            const id = 'n' + Date.now();
            cy.add([
                { group: 'nodes', data: { id, label: 'æ–°åˆ†æ”¯' }, position: { x: sel.position().x + 100, y: sel.position().y } },
                { group: 'edges', data: { source: sel.id(), target: id } }
            ]);
            cy.layout({ name: 'breadthfirst', directed: true }).run();
        }

        window.onload = initCy;
    </script>
</body>
</html>
